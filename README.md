[А вот и демострация (тыкабельно)](https://drive.google.com/file/d/10JD_rTuBCt5HtCeFxE_VCHrHSsyLJGQ-/view?usp=sharing)
Получилось скомканно, не очень хорошо разобрал сам скрипт.

2 замечение по коду - отсуствуют обработчики ошибок;
3 замечание - макароны какие-то, всё слишком разбросано и переплетено;
4 - экстракт я бы сделал не сразу всех файлов из папки, а одного файла по ссылке. 

В дополнение: если у таблицы отсутствуют первичные ключи, то она перезаписывается. Эту часть кода было видно.
